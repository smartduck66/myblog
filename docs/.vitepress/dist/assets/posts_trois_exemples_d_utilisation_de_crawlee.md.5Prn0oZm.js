import{_ as t,c as n,m as s,a as e,t as a,V as l,o as r,aw as h,ax as p,ay as k,az as d}from"./chunks/framework.DyooxGaQ.js";const A=JSON.parse(`{"title":"Trois exemples d'utilisation de crawlee","description":"","frontmatter":{"title":"Trois exemples d'utilisation de crawlee","date":"2023-06-16T00:00:00.000Z","category":["outils"],"tag":["automation"],"archive":false},"headers":[],"relativePath":"posts/trois_exemples_d_utilisation_de_crawlee.md","filePath":"posts/trois_exemples_d_utilisation_de_crawlee.md"}`),o={name:"posts/trois_exemples_d_utilisation_de_crawlee.md"},E={id:"frontmatter-title",tabindex:"-1"},g=s("a",{class:"header-anchor",href:"#frontmatter-title","aria-label":'Permalink to "{{ $frontmatter.title }}"'},"‚Äã",-1),u={id:"frontmatter-date-substring-8-10-frontmatter-date-substring-5-7-frontmatter-date-substring-0-4",tabindex:"-1"},c=s("br",null,null,-1),m=s("br",null,null,-1),y=s("a",{class:"header-anchor",href:"#frontmatter-date-substring-8-10-frontmatter-date-substring-5-7-frontmatter-date-substring-0-4","aria-label":'Permalink to ":calendar: {{ $frontmatter.date.substring(8,10) }}/{{ $frontmatter.date.substring(5,7) }}/{{ $frontmatter.date.substring(0,4) }}<br><br>"'},"‚Äã",-1),F=l('<br><p><img src="'+h+'" alt="IMG" title="logo crawlee"><br><br> R√©cemment, l&#39;un de mes coll√®gues souhaitait r√©cup√©rer une donn√©e issue du site public de la Haute Autorit√© de Sant√© et ce, pour chacun des 7.500 √©tablissements r√©f√©renc√©s ! Evidemment, c&#39;√©tait un travail trop long √† effectuer manuellement et j&#39;ai eu le r√©flexe de lui proposer d&#39;utiliser un crawler Javascript. Pour la petite histoire, dans les ann√©es 80, je faisais la m√™me chose sur des services videotex (Minitel) üòâ</p><p>Bref, apr√®s quelques recherches, la librairie <a href="https://crawlee.dev/" target="_blank" rel="noreferrer">crawlee</a> m&#39;a paru r√©pondre √† ce besoin de <em>web scraping</em> et je vais vous partager trois exemples mis en oeuvre. Pas de souci particulier sur son installation, parfaitement expliqu√©e dans la <a href="https://crawlee.dev/docs/quick-start" target="_blank" rel="noreferrer">documentation</a> de l&#39;outil, et j&#39;ai donc choisi le crawler Playwright dont j&#39;avais d√©j√† entendu parler. Cheerio ou Puppeteer sont √©galement disponibles.</p><h4 id="exemple-n¬∞1-recuperer-la-date-de-certification-des-etablissements-recenses-par-la-has" tabindex="-1">Exemple n¬∞1 : r√©cup√©rer la date de certification des √©tablissements recens√©s par la HAS <a class="header-anchor" href="#exemple-n¬∞1-recuperer-la-date-de-certification-des-etablissements-recenses-par-la-has" aria-label="Permalink to &quot;Exemple n¬∞1 : r√©cup√©rer la date de certification des √©tablissements recens√©s par la HAS&quot;">‚Äã</a></h4><p>Le besoin √©tait donc de r√©cup√©rer cette date de certification, pr√©sent√©e de la mani√®re suivante, sur chaque <a href="https://www.has-sante.fr/jcms/1_FicheEtablissement/fr/" target="_blank" rel="noreferrer">page</a> : <br><br><img src="'+p+`" alt="IMG" title="Emplacement de la date de certification √† r√©cup√©rer"><br><a href="https://crawlee.dev/docs/introduction/real-world-project" target="_blank" rel="noreferrer">L&#39;exemple</a> tr√®s didactique expos√© dans la documentation vous permet de tester la r√©cup√©ration de diff√©rents √©l√©ments d&#39;une page. J&#39;ai pu appliquer assez facilement les commandes d√©crites (<em>locator, getByRole, filter, textContent</em>) pour r√©cup√©rer respectivement le nom de l&#39;√©tablissement, l&#39;√©tablissement de rattachement ainsi que la fameuse date :</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nom_etablissement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">locator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;h1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">textContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> etablissement_rattachement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getByRole</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;listitem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ hasText: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;√âtablissement de rattachement :&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">innerText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> date_certification</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">locator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;div.blocDate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">first</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">textContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p><strong>Un point important</strong> : je trouve toutefois que la documentation de la librairie <a href="https://playwright.dev/docs/api/class-playwright" target="_blank" rel="noreferrer">Playwright</a> est plus compl√®te, pour appr√©hender l&#39;ensemble de ses possibilit√©s.</p><h4 id="exemple-n¬∞2-recuperer-des-posts-du-site-pharaon-magazine" tabindex="-1">Exemple n¬∞2 : r√©cup√©rer des <em>posts</em> du site Pharaon Magazine <a class="header-anchor" href="#exemple-n¬∞2-recuperer-des-posts-du-site-pharaon-magazine" aria-label="Permalink to &quot;Exemple n¬∞2 : r√©cup√©rer des *posts* du site Pharaon Magazine&quot;">‚Äã</a></h4><p>Le second cas d&#39;usage est un peu plus complexe. Mon fr√®re d√©sirait tester la r√©cup√©ration automatique des billets de son site <a href="https://www.pharaon-magazine.fr/" target="_blank" rel="noreferrer">Pharaon Magazine</a> dans le cadre d&#39;une √©ventuelle future refonte. Voici un exemple d&#39;article : <br><br></p><blockquote><p><img src="`+k+`" alt="IMG" title="Exemple de billet tir√© du site Pharaon Magazine"><br></p></blockquote><p>Le code pour r√©cup√©rer le titre, la date, l&#39;auteur et le contenu d&#39;un billet est le suivant :</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> titre_billet</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">locator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;h1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">textContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> submitted</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">locator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;div.meta &gt; div.submitted&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">textContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (submitted) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> datePattern</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\\b</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">{2}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[//]\\d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">{2}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[//]\\d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">{4}\\b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> matches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> submitted.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(datePattern);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   date_billet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> matches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   auteur_billet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> submitted.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(submitted.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;‚Äî&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contenu_billet</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">locator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;div.node &gt; div.content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">textContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>Comment sait-on, par exemple, que la date et l&#39;auteur se trouvent dans <em>div.meta &gt; div.submitted</em> ? En fait, c&#39;est l√† que l&#39;analyse du source de la page via les outils de d√©veloppement de Google Chrome (rubrique Elements) s&#39;av√®re indispensable üòâ</p><p>Enfin, comment crawler les 234 pages du site automatiquement ? J&#39;ai repris simplement la commande <em>enqueueLinks</em> de la mani√®re suivante :</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// On r√©cup√®re tous les liens des pages (1 √† 234), sous la forme &quot;/node?page=x&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> links</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> enqueueLinks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.pager-item &gt; a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LIST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// On r√©cup√®re les liens des billets sur CHAQUE page</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">waitForSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.view-content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> enqueueLinks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.title &gt; a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DETAIL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &lt;= note the different label</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><br><h4 id="exemple-n¬∞3-recuperer-le-nombre-d-avis-google" tabindex="-1">Exemple n¬∞3 : r√©cup√©rer le nombre d&#39;avis Google <a class="header-anchor" href="#exemple-n¬∞3-recuperer-le-nombre-d-avis-google" aria-label="Permalink to &quot;Exemple n¬∞3 : r√©cup√©rer le nombre d&#39;avis Google&quot;">‚Äã</a></h4><p>Autre commande utilis√©e : <em>getByText(&quot;quelque chose&quot;)</em>. Dans ce dernier exemple, je souhaitais r√©cup√©rer le nombre d&#39;avis Google my Business d&#39;une liste de magasins. <br><br><img src="`+d+'" alt="IMG" title="Exemple d&#39;un nombre d&#39;avis Google sur une pharmacie"><br> A noter que dans chaque page visit√©e, ce nombre apparait deux fois, d&#39;o√π la commande <em>first</em> qui est n√©cessaire pour signifier au crawler qu&#39;il peut s&#39;arr√™ter d√®s qu&#39;il trouve une valeur. Sans cela, il plante...</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> avis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getByText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;avis Google&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">first</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">textContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><br><h4 id="un-outil-tres-complet" tabindex="-1">Un outil tr√®s complet <a class="header-anchor" href="#un-outil-tres-complet" aria-label="Permalink to &quot;Un outil tr√®s complet&quot;">‚Äã</a></h4><p>Voil√†, j&#39;esp√®re que ces quelques exemples vous auront donn√© l&#39;envie de tester cet outil. Je n&#39;ai fait que que &quot;gratter&quot; la surface d&#39;une librairie tr√®s compl√®te, relativement simple √† utiliser et tr√®s performante. Impressionnant de constater en effet la vitesse d&#39;ex√©cution du crawling de centaines de pages ! Crawlee peut vraiment vous faire √©conomiser des heures de travail üòÉ</p><p><a href="/">&gt; Accueil</a> <a href="/articles.html">&gt; Tous les articles</a></p>',23);function b(i,C,f,_,q,v){return r(),n("div",null,[s("h1",E,[e(a(i.$frontmatter.title)+" ",1),g]),s("h5",u,[e("üìÜ "+a(i.$frontmatter.date.substring(8,10))+"/"+a(i.$frontmatter.date.substring(5,7))+"/"+a(i.$frontmatter.date.substring(0,4)),1),c,m,e(),y]),F])}const x=t(o,[["render",b]]);export{A as __pageData,x as default};
